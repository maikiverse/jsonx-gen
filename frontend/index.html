<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>JSONX-Gen</title>
  <style>
    .input-group {
      margin: 10px 0;
    }
    .input-group input, .input-group textarea {
      width: 60%;
      box-sizing: border-box;
    }
    .select-group {
      margin: 10px 0;
      display: flex;
      gap: 20px;
      align-items: flex-end;
    }
    .select-container {
      display: flex;
      flex-direction: column;
    }
    .select-container label {
      font-size: 0.8em;
      color: #666;
      margin-bottom: 4px;
    }
    .select-container select {
      min-width: 120px;
    }
    button {
      padding: 5px 15px;
      margin-left: 10px;
    }
    .toggle-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 10px 0;
    }
    .toggle-group label {
      font-size: 0.8em;
      color: #666;
    }
    .input-method {
      display: none;
    }
    .input-method.active {
      display: block;
    }
  </style>
</head>
<body>
  <h2>JSONX-GEN</h2>
  <p>Search JSON object for keywords and generate extraction code for all matching paths:</p>

  <div class="select-group">
    <div class="select-container">
      <label for="mode">Match Mode</label>
      <select id="mode">
        <option value="match">match</option>
        <option value="contains">contains</option>
        <option value="startswith">startswith</option>
        <option value="endswith">endswith</option>
      </select>
    </div>

    <div class="select-container">
      <label for="type">Match Type</label>
      <select id="type">
        <option value="all">all</option>
        <option value="key">key</option>
        <option value="value">value</option>
      </select>
    </div>

    <div class="select-container">
      <label for="language">Language</label>
      <select id="language">
        <option value="javascript">JavaScript</option>
        <option value="mysql">MySQL</option>
        <option value="php">PHP</option>
        <option value="python">Python</option>
        <option value="pyspark">PySpark</option>
        <option value="spark_sql">Spark SQL</option>
      </select>
    </div>
  </div>

  <div class="toggle-group">
    <label>Input Method:</label>
    <input type="radio" id="json-text" name="input-method" value="text" checked onchange="toggleInputMethod()">
    <label for="json-text">JSON Text</label>
    <input type="radio" id="json-file" name="input-method" value="file" onchange="toggleInputMethod()">
    <label for="json-file">File/URL</label>
  </div>

  <div id="json-text-input" class="input-method active">
    <div class="input-group">
      <textarea id="json" rows="12" placeholder="Paste your JSON here..."></textarea>
    </div>
  </div>

  <div id="json-file-input" class="input-method">
    <div class="input-group">
      <input id="file-path" placeholder="Enter file path or URL...">
    </div>
  </div>

  <div class="input-group">
    <input id="keywords" placeholder="comma,separated,keywords">
  </div>
  <button onclick="extract()">Generate</button>

  <h3>Result:</h3>
  <pre id="result" style="background:#f4f4f4; padding:1em; border:1px solid #ccc;"></pre>

  <script>
    function toggleInputMethod() {
      const textInput = document.getElementById('json-text-input');
      const fileInput = document.getElementById('json-file-input');
      const isText = document.getElementById('json-text').checked;
      
      textInput.classList.toggle('active', isText);
      fileInput.classList.toggle('active', !isText);
    }

    async function extract() {
      try {
        const isText = document.getElementById('json-text').checked;
        let jsonObj;

        if (isText) {
          const jsonText = document.getElementById("json").value;
          if (!jsonText.trim()) {
            throw new Error("Please enter JSON input");
          }
          try {
            jsonObj = JSON.parse(jsonText);
          } catch (e) {
            throw new Error(`Invalid JSON: ${e.message}`);
          }
        } else {
          const filePath = document.getElementById("file-path").value;
          if (!filePath.trim()) {
            throw new Error("Please enter a file path or URL");
          }
          // For GET request with file path
          const params = new URLSearchParams();
          params.append('file_path', filePath);
          const keywords = document.getElementById("keywords").value.split(",").map(k => k.trim()).filter(Boolean);
          const mode = document.getElementById("mode").value;
          const type = document.getElementById("type").value;
          const language = document.getElementById("language").value;
          params.append('keywords', keywords.join(','));
          params.append('mode', mode);
          params.append('type', type);
          if (language) {
            params.append('language', language);
          }
          const response = await fetch(`/extract?${params.toString()}`);
          const data = await response.json();
          if (!response.ok) {
            throw new Error(data.error || 'Server error');
          }
          document.getElementById("result").textContent = data.code;
          return;
        }

        const keywords = document.getElementById("keywords").value.split(",").map(k => k.trim()).filter(Boolean);
        if (keywords.length === 0) {
          throw new Error("Please enter at least one keyword");
        }

        const mode = document.getElementById("mode").value;
        const type = document.getElementById("type").value;
        const language = document.getElementById("language").value;

        // For POST request with JSON object
        const response = await fetch('/extract', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({
            json_obj: jsonObj,
            keywords: keywords,
            mode: mode,
            type: type,
            language: language
          })
        });

        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.error || 'Server error');
        }

        document.getElementById("result").textContent = data.code;
      } catch (err) {
        document.getElementById("result").textContent = "Error: " + err.message;
      }
    }
  </script>
</body>
</html>
